<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RSVP Train — Scroll Reader</title>
  <style>
    :root{
      --bg:#0b0f14; --card:#111922; --text:#e8f0ff; --muted:#9fb3c8; --acc:#5aa0ff; --rail:#0f1621;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:system-ui, Inter, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color:var(--text); background:linear-gradient(180deg,#0b0f14,#0a1018 35%,#0b0f14); display:flex; flex-direction:column; align-items:center; gap:16px; padding:20px}
    header, .card{width:100%; max-width:1000px}
    h1{margin:0 0 6px}
    p.caption{margin:0; color:var(--muted)}
    .card{background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:16px; padding:16px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
    textarea{width:100%; min-height:120px; resize:vertical; background:#0c141e; color:var(--text); border:1px solid #223043; border-radius:12px; padding:12px; line-height:1.4}
    .controls{display:flex; flex-wrap:wrap; gap:12px; align-items:center; margin-top:12px}
    button{appearance:none; border:none; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; background:var(--acc); color:#06101c}
    button.secondary{background:#1c2736; color:var(--text); border:1px solid #223043}
    .pill{padding:6px 10px; border-radius:999px; background:#0f1a27; border:1px solid #223043; color:var(--muted); font-size:12px}
    input[type="number"], input[type="range"]{accent-color:var(--acc); background:#0c141e; color:var(--text); border:1px solid #223043; border-radius:10px; padding:8px}

    /* Reader viewport */
    .viewport{position:relative; height:42vh; min-height:260px; border-radius:18px; border:1px solid rgba(255,255,255,.06); background:radial-gradient(ellipse at center, #121b27 0%, #0d141d 62%); overflow:hidden;}
    .rail{position:absolute; inset:0; display:flex; align-items:center}
    .stream{position:absolute; left:0; top:50%; transform:translateY(-50%); white-space:nowrap; will-change:transform}
    .word{display:inline-block; padding:0 .45em; font-weight:800; font-size:clamp(36px, 8.8vw, 96px)}
    .guide{position:absolute; top:0; bottom:0; left:50%; width:0; border-left:2px dashed #2a3a52; opacity:.6}
    .progress{height:6px; width:100%; background:#0e1823; border-radius:999px; overflow:hidden; border:1px solid #223043; margin-top:10px}
    .progress>span{display:block; height:100%; width:0%; background:linear-gradient(90deg, #3a79ff, #2ee7ff)}
    .hud{position:absolute; bottom:10px; left:12px; right:12px; display:flex; justify-content:space-between; color:var(--muted); font-size:13px}
    .ghost{opacity:.6}
  </style>
</head>
<body>
  <header>
    <h1>RSVP Train — Scroll Reader</h1>
    <p class="caption">Paste a paragraph, set words‑per‑minute (1–1000), press <b>Start</b>. Words glide <i>right → left</i> like a train. Keep your eyes on the center guideline; each word crosses the line exactly on beat.</p>
  </header>

  <section class="card">
    <textarea id="textInput">I am who I am. This is a smooth, center‑locked reading train. Your eyes relax at the guide while words pass on rhythm. Adjust WPM to suit your comfort.</textarea>

    <div class="controls">
      <button id="startBtn">Start</button>
      <button id="pauseBtn" class="secondary" disabled>Pause</button>
      <button id="stopBtn" class="secondary" disabled>Stop</button>
      <span class="pill">WPM <input id="wpmNum" type="number" min="1" max="1000" value="300" style="width:84px; margin-left:6px"></span>
      <input id="wpmRange" type="range" min="1" max="1000" value="300" style="flex:1; min-width:160px">
      <span id="status" class="pill">Idle</span>
    </div>

    <div class="viewport" id="viewport">
      <div class="rail">
        <div class="stream" id="stream"></div>
      </div>
      <div class="guide" aria-hidden="true"></div>
      <div class="hud">
        <span id="nowWord" class="ghost"></span>
        <div class="progress"><span id="bar"></span></div>
      </div>
    </div>
  </section>

<script>
(function(){
  const el = id => document.getElementById(id);
  const viewport = el('viewport');
  const stream = el('stream');
  const status = el('status');
  const nowWord = el('nowWord');
  const bar = el('bar');

  let tokens = [];
  let centers = []; // x centers of each word within the stream
  let rafId = null;
  let startTs = 0;        // animation start time
  let paused = false;
  let pauseOffset = 0;    // ms elapsed when paused
  const minGapPx = 28;    // padding between words (additional to CSS)

  function tokenize(text){
    return (text.match(/\S+/g) || []);
  }

  function buildStream(){
    stream.innerHTML = '';
    centers = [];
    // Create spans
    tokens.forEach((w, idx)=>{
      const span = document.createElement('span');
      span.className = 'word';
      span.textContent = w;
      stream.appendChild(span);
      if(idx < tokens.length - 1){
        const spacer = document.createElement('span');
        spacer.textContent = '\u00A0';
        spacer.style.display = 'inline-block';
        spacer.style.width = minGapPx + 'px';
        stream.appendChild(spacer);
      }
    });
    // After layout, compute centers
    const words = Array.from(stream.querySelectorAll('.word'));
    centers = words.map(w=>{
      const r = w.getBoundingClientRect();
      const s = stream.getBoundingClientRect();
      const centerX = (r.left - s.left) + r.width/2;
      return centerX;
    });
    // Ensure we have at least two centers to interpolate smoothly
    if(centers.length < 2){ centers = [0, 1]; }
  }

  function setProgressByTime(ms){
    const interval = 60000 / currentWpm(); // ms per word
    const idx = Math.min(tokens.length, Math.max(0, ms / interval));
    const pct = tokens.length ? Math.min(100, (idx / tokens.length) * 100) : 0;
    bar.style.width = pct + '%';
  }

  function currentWpm(){
    const n = Math.max(1, Math.min(1000, Number(el('wpmNum').value) || 1));
    return n;
  }

  function syncWpmInputs(val){
    el('wpmNum').value = val; el('wpmRange').value = val;
  }

  function start(){
    stop();
    const text = el('textInput').value.trim();
    if(!text){ alert('Please paste some text'); return; }
    tokens = tokenize(text);
    buildStream();
    startTs = performance.now();
    pauseOffset = 0; paused = false;
    status.textContent = 'Running';
    el('startBtn').disabled = true; el('pauseBtn').disabled = false; el('stopBtn').disabled = false;
    tick();
  }

  function pause(){
    if(!rafId) return;
    if(!paused){
      paused = true; cancelAnimationFrame(rafId); rafId = null;
      pauseOffset += performance.now() - startTs; // elapsed so far
      status.textContent = 'Paused';
    } else {
      paused = false; startTs = performance.now();
      status.textContent = 'Running';
      tick();
    }
  }

  function stop(){
    if(rafId){ cancelAnimationFrame(rafId); rafId = null; }
    status.textContent = 'Idle';
    el('startBtn').disabled = false; el('pauseBtn').disabled = true; el('stopBtn').disabled = true;
    stream.style.transform = 'translate3d(0, -50%, 0)';
    nowWord.textContent = '';
    bar.style.width = '0%';
  }

  function findWordAtTime(ms){
    const interval = 60000 / currentWpm(); // ms per word
    const k = Math.floor(ms / interval);
    const f = (ms - k*interval) / interval; // 0..1 between k and k+1
    return {k, f};
  }

  function desiredCenterAt(ms){
    const {k, f} = findWordAtTime(ms);
    const a = centers[Math.min(k, centers.length-1)];
    const b = centers[Math.min(k+1, centers.length-1)];
    return a + (b - a) * f;
  }

  function tick(){
    const vpRect = viewport.getBoundingClientRect();
    const centerScreen = vpRect.width/2;

    const now = performance.now();
    const elapsed = (now - startTs) + pauseOffset; // ms since start

    // Translate so that desired center aligns to viewport center
    const dest = desiredCenterAt(elapsed);
    const translateX = centerScreen - dest;
    stream.style.transform = `translate3d(${translateX}px, -50%, 0)`;

    // Update HUD
    const {k} = findWordAtTime(elapsed);
    const idx = Math.min(k, tokens.length-1);
    nowWord.textContent = tokens[idx] || '';
    setProgressByTime(elapsed);

    // Stop when last word is past the center by one interval
    const doneInterval = 60000 / currentWpm();
    if(idx >= tokens.length-1 && (elapsed > (tokens.length * doneInterval + 200))){
      stop();
      return;
    }

    rafId = requestAnimationFrame(tick);
  }

  // Wire controls
  el('startBtn').addEventListener('click', start);
  el('pauseBtn').addEventListener('click', pause);
  el('stopBtn').addEventListener('click', stop);
  el('wpmNum').addEventListener('change', e=>{
    let v = Math.max(1, Math.min(1000, Number(e.target.value)||300));
    syncWpmInputs(v);
  });
  el('wpmRange').addEventListener('input', e=>{
    syncWpmInputs(e.target.value);
  });

  // Keyboard: space to pause/play; S to start; Esc to stop
  document.addEventListener('keydown', (e)=>{
    if(e.code === 'Space'){ e.preventDefault(); if(el('pauseBtn').disabled) return; pause(); }
    if(e.key.toLowerCase() === 's'){ start(); }
    if(e.key === 'Escape'){ stop(); }
  });
})();
</script>
</body>
</html>
